<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Cons Game</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 100vw; height: 100vh;
    overflow: hidden;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    font-family: 'Comic Sans MS', cursive, sans-serif;
    color: white;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: none;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #281557;
    border-radius: 12px;
    box-shadow: 0 0 30px #fff3;
    width: 100vw;
    height: 100vh;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  // Setup canvas size for device pixel ratio
  function resize() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resize();
  window.addEventListener('resize', resize);

  // Bat player
  const bat = {
    x: canvas.width / 2,
    y: canvas.height - 60,
    width: 60,
    height: 30,
    speed: 8,
    targetX: canvas.width / 2
  };

  // Hearts falling
  const hearts = [];
  const heartRadius = 15;
  const heartSpeed = 3;
  const maxMissed = 5;
  let score = 0;
  let missed = 0;
  let gameOver = false;

  // Spawn hearts every 1.2 seconds
  function spawnHeart() {
    const x = Math.random() * (canvas.width - heartRadius * 2) + heartRadius;
    hearts.push({ x, y: -heartRadius, radius: heartRadius });
  }
  setInterval(() => {
    if (!gameOver) spawnHeart();
  }, 1200);

  // Move bat toward targetX smoothly
  function moveBat() {
    const dx = bat.targetX - bat.x;
    if (Math.abs(dx) > 1) {
      bat.x += dx * 0.25;
    }
  }

  // On tap, move bat left or right depending on touch position
  function handleTap(e) {
    e.preventDefault();
    if (gameOver) {
      resetGame();
      return;
    }
    let x = e.touches ? e.touches[0].clientX : e.clientX;
    if (x < window.innerWidth / 2) {
      // Move left
      bat.targetX = Math.max(bat.x - bat.speed * 3, bat.width / 2);
    } else {
      // Move right
      bat.targetX = Math.min(bat.x + bat.speed * 3, canvas.width - bat.width / 2);
    }
  }
  document.addEventListener('touchstart', handleTap, { passive: false });
  document.addEventListener('mousedown', handleTap);

  // Reset game state
  function resetGame() {
    score = 0;
    missed = 0;
    hearts.length = 0;
    gameOver = false;
    bat.x = canvas.width / 2;
    bat.targetX = canvas.width / 2;
  }

  // Update game state
  function update() {
    if (gameOver) return;

    moveBat();

    for (let i = hearts.length - 1; i >= 0; i--) {
      hearts[i].y += heartSpeed;

      // Check collision (circle to rect)
      const dx = Math.abs(hearts[i].x - bat.x);
      const dy = Math.abs(hearts[i].y - bat.y);
      if (dx < bat.width / 2 + hearts[i].radius && dy < bat.height / 2 + hearts[i].radius) {
        hearts.splice(i, 1);
        score++;
        continue;
      }

      // Remove heart if missed
      if (hearts[i].y - hearts[i].radius > canvas.height) {
        hearts.splice(i, 1);
        missed++;
        if (missed >= maxMissed) gameOver = true;
      }
    }
  }

  // Draw heart shape
  function drawHeart(x, y, size, color) {
    ctx.fillStyle = color;
    ctx.beginPath();
    const topCurveHeight = size * 0.3;
    ctx.moveTo(x, y + topCurveHeight);
    ctx.bezierCurveTo(x, y, x - size / 2, y, x - size / 2, y + topCurveHeight);
    ctx.bezierCurveTo(x - size / 2, y + (size + topCurveHeight) / 2, x, y + (size + topCurveHeight) / 1.5, x, y + size);
    ctx.bezierCurveTo(x, y + (size + topCurveHeight) / 1.5, x + size / 2, y + (size + topCurveHeight) / 2, x + size / 2, y + topCurveHeight);
    ctx.bezierCurveTo(x + size / 2, y, x, y, x, y + topCurveHeight);
    ctx.closePath();
    ctx.fill();
  }

  // Draw simple cute bat
  function drawBat() {
    // Wings (purple)
    ctx.fillStyle = '#6b3a96';
    ctx.beginPath();
    ctx.moveTo(bat.x - bat.width / 2, bat.y);
    ctx.lineTo(bat.x - bat.width / 4, bat.y - bat.height);
    ctx.lineTo(bat.x - bat.width / 8, bat.y);
    ctx.lineTo(bat.x, bat.y - bat.height / 2);
    ctx.lineTo(bat.x + bat.width / 8, bat.y);
    ctx.lineTo(bat.x + bat.width / 4, bat.y - bat.height);
    ctx.lineTo(bat.x + bat.width / 2, bat.y);
    ctx.closePath();
    ctx.fill();

    // Body (lighter purple)
    ctx.fillStyle = '#a67ee3';
    ctx.beginPath();
    ctx.ellipse(bat.x, bat.y - bat.height / 4, bat.width / 6, bat.height / 2, 0, 0, Math.PI * 2);
    ctx.fill();

    // Eyes (white)
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.ellipse(bat.x - 8, bat.y - bat.height / 4, 5, 7, 0, 0, Math.PI * 2);
    ctx.ellipse(bat.x + 8, bat.y - bat.height / 4, 5, 7, 0, 0, Math.PI * 2);
    ctx.fill();

    // Pupils (black)
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.ellipse(bat.x - 8, bat.y - bat.height / 4, 2, 3, 0, 0, Math.PI * 2);
    ctx.ellipse(bat.x + 8, bat.y - bat.height / 4, 2, 3, 0, 0, Math.PI * 2);
    ctx.fill();
  }

  // Draw game elements
  function draw() {
    // Background gradient
    const bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
    bg.addColorStop(0, '#6a11cb');
    bg.addColorStop(1, '#2575fc');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw hearts
    hearts.forEach(h => drawHeart(h.x, h.y, h.radius * 2, '#ff6b81'));

    // Draw bat
    drawBat();

    // Draw score and missed
    ctx.fillStyle = 'white';
    ctx.font = 'bold 28px Comic Sans MS, cursive, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(`Score: ${score}`, 20, 40);
    ctx.fillText(`Missed: ${missed} / ${maxMissed}`, 20, 80);

    // Game over overlay
    if (gameOver) {
      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#ff6b81';
      ctx.font = '36px Comic Sans MS, cursive, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText("Oh no! Too many missed hearts!", canvas.width / 2, canvas.height / 2 - 20);
      ctx.fillText("Tap to try again ðŸ’–", canvas.width / 2, canvas.height / 2 + 40);
    }
  }

  // Game loop
  function loop() {
    if (!gameOver) update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
</script>

</body>
</html>
