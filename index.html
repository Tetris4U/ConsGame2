<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <title>Cute Batman Catch Game (Phone Safe Area)</title>
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(to bottom, #020202, #1a1a1a);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #FFD700;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
      touch-action: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #gameCanvas {
      display: block;
      width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right));
      height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      background: transparent;
      touch-action: none;
      margin: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      border-radius: 8px;
      box-shadow: 0 0 20px #FFD700AA;
    }
    #desktopMessage {
      display: none;
      width: 100vw;
      height: 100vh;
      background: #000;
      color: #FFD700;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="desktopMessage">Please open this game on your phone to play. ðŸ¦‡</div>

<script>
  const isPhone = window.matchMedia("(max-width: 768px)").matches;
  const canvas = document.getElementById('gameCanvas');
  const desktopMsg = document.getElementById('desktopMessage');
  const ctx = canvas.getContext('2d');

  if (!isPhone) {
    // Show message and hide canvas on desktop
    canvas.style.display = 'none';
    desktopMsg.style.display = 'flex';
  } else {
    desktopMsg.style.display = 'none';
    canvas.style.display = 'block';

    function resize() {
      const dpr = window.devicePixelRatio || 1;

      // Safe area insets (fallback 0)
      const safeTop = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('env(safe-area-inset-top)')) || 0;
      const safeRight = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('env(safe-area-inset-right)')) || 0;
      const safeBottom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('env(safe-area-inset-bottom)')) || 0;
      const safeLeft = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('env(safe-area-inset-left)')) || 0;

      const width = window.innerWidth - safeLeft - safeRight;
      const height = window.innerHeight - safeTop - safeBottom;

      canvas.width = width * dpr;
      canvas.height = height * dpr;
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      // Update bat position boundaries for new height
      bat.y = Math.min(bat.y, canvas.height - bat.radius);
      if (bat.y < canvas.height / 2) bat.y = canvas.height / 2;
    }
    window.addEventListener('resize', resize);

    // Game variables
    const gravity = 0.5;
    const jumpPower = -8;
    const starFallSpeed = 3;
    const maxMissed = 8;

    let score = 0;
    let missed = 0;
    let gameOver = false;

    // Bat orb player
    const bat = {
      x: canvas.width / 2,
      y: canvas.height - 80,
      radius: 20,
      vy: 0
    };

    // Stars to catch
    let stars = [];

    // Spawn stars falling from random x positions
    function spawnStar() {
      const x = Math.random() * (canvas.width - 40) + 20;
      stars.push({ x, y: -20, radius: 12 });
    }
    setInterval(() => {
      if (!gameOver) spawnStar();
    }, 1300);

    // Handle touch tap to jump bat orb up
    function tap(e) {
      e.preventDefault();
      if (gameOver) {
        reset();
        return;
      }
      bat.vy = jumpPower;
    }
    document.addEventListener('touchstart', tap, { passive: false });

    // Reset game state
    function reset() {
      score = 0;
      missed = 0;
      stars = [];
      bat.y = canvas.height - 80;
      bat.vy = 0;
      gameOver = false;
    }

    // Update game logic
    function update() {
      if (gameOver) return;

      // Bat physics
      bat.vy += gravity;
      bat.y += bat.vy;

      // Keep bat inside bottom half of screen
      if (bat.y > canvas.height - bat.radius) {
        bat.y = canvas.height - bat.radius;
        bat.vy = 0;
      }
      if (bat.y < canvas.height / 2) {
        bat.y = canvas.height / 2;
        bat.vy = 0;
      }

      // Update stars falling
      for (let i = stars.length - 1; i >= 0; i--) {
        stars[i].y += starFallSpeed;

        // Check if bat caught the star (circle collision)
        const dx = bat.x - stars[i].x;
        const dy = bat.y - stars[i].y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < bat.radius + stars[i].radius) {
          stars.splice(i, 1);
          score++;
          continue;
        }

        // Remove star if missed (fell off screen)
        if (stars[i].y - stars[i].radius > canvas.height) {
          stars.splice(i, 1);
          missed++;
          if (missed >= maxMissed) gameOver = true;
        }
      }
    }

    // Draw everything
    function draw() {
      // Gotham background gradient
      const bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
      bg.addColorStop(0, '#020202');
      bg.addColorStop(1, '#1a1a1a');
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw bat orb with glow and cute smiley face
      ctx.shadowBlur = 20;
      ctx.shadowColor = '#FFD700';
      ctx.beginPath();
      ctx.arc(bat.x, bat.y, bat.radius, 0, Math.PI * 2);
      ctx.fillStyle = '#FFD700';
      ctx.fill();
      ctx.shadowBlur = 0;

      // Smiley eyes
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(bat.x - 7, bat.y - 6, 4, 0, Math.PI * 2);
      ctx.arc(bat.x + 7, bat.y - 6, 4, 0, Math.PI * 2);
      ctx.fill();

      // Smiley mouth
      ctx.beginPath();
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 4;
      ctx.lineCap = 'round';
      ctx.arc(bat.x, bat.y + 5, 10, 0, Math.PI);
      ctx.stroke();

      // Draw stars as glowing gold circles
      stars.forEach(star => {
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#FFD700';
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#FFD700';
        ctx.fill();
        ctx.shadowBlur = 0;
      });

      // Score and misses display
      ctx.fillStyle = '#FFD700';
      ctx.font = 'bold 32px Comic Sans MS, cursive, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText(`Score: ${score}`, 20, 50);
      ctx.fillText(`Missed: ${missed} / ${maxMissed}`, 20, 90);

      // Game over screen with message + "Con"
      if (gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.8)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#FFD700';
        ctx.font = '36px Comic Sans MS, cursive, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText("Don't work too hard ðŸ¦‡ Con", canvas.width / 2, canvas.height / 2 - 20);

        ctx.font = '24px Comic Sans MS, cursive, sans-serif';
        ctx.fillText("Tap to Play Again", canvas.width / 2, canvas.height / 2 + 40);
      }
    }

    // Main game loop
    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // Start
    resize();
    loop();
  }
</script>

</body>
</html>

